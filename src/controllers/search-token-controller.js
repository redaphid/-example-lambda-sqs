// Generated by CoffeeScript 2.4.1
var JobToHttp, SearchTokenController, _, debug;

debug = require('debug')('meshblu-core-protocol-adapter-http:search-token-controller');

_ = require('lodash');

JobToHttp = require('../helpers/job-to-http');

SearchTokenController = class SearchTokenController {
  constructor({jobManager, jobToHttp}) {
    this.search = this.search.bind(this);
    this.jobManager = jobManager;
    this.jobToHttp = jobToHttp;
  }

  search(req, res) {
    var error, job;
    job = this.jobToHttp.httpToJob({
      jobType: 'SearchTokens',
      request: req
    });
    if (job.metadata.projection != null) {
      try {
        job.metadata.projection = JSON.parse(job.metadata.projection);
      } catch (error1) {
        error = error1;
      }
    }
    debug('dispatching request', job);
    return this.jobManager.do(job, (error, jobResponse) => {
      if (error != null) {
        return res.sendError(error);
      }
      return this.jobToHttp.sendJobResponse({jobResponse, res});
    });
  }

};

module.exports = SearchTokenController;
