// Generated by CoffeeScript 2.4.1
var MeshbluAuthParser, WhoamiController, debug;

debug = require('debug')('meshblu-core-protocol-adapter-http:whoami-controller');

MeshbluAuthParser = require('../helpers/meshblu-auth-parser');

WhoamiController = class WhoamiController {
  constructor({jobManager, jobToHttp}) {
    this.show = this.show.bind(this);
    this.jobManager = jobManager;
    this.jobToHttp = jobToHttp;
    this.authParser = new MeshbluAuthParser;
  }

  show(req, res) {
    var auth, job;
    auth = this.authParser.parse(req);
    job = this.jobToHttp.httpToJob({
      jobType: 'GetDevice',
      request: req,
      toUuid: auth.uuid
    });
    debug('dispatching request', job);
    return this.jobManager.do(job, (error, jobResponse) => {
      if (error != null) {
        return res.sendError(error);
      }
      return this.jobToHttp.sendJobResponse({jobResponse, res});
    });
  }

};

module.exports = WhoamiController;
